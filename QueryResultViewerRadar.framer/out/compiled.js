// Generated by CoffeeScript 1.7.1
try {
  this.liveReload = new WebSocket("ws://" + window.location.host + "/live-reload");
  this.liveReload.onmessage = function(msg) {
    if (msg.data === "reload") {
      return location.reload();
    }
  };
} catch (_error) {
  console.log("Live Reload Failed, gotta press that reload button :(");
}


window.Resources = {"icon.png":{"path":"images\/icon.png","width":151,"height":151}};

// Generated by CoffeeScript 1.7.1
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

this.Pulser = (function(_super) {
  __extends(Pulser, _super);

  function Pulser(opts) {
    this.grow = __bind(this.grow, this);
    Pulser.__super__.constructor.call(this, opts);
    this.borderRadius = "50%";
    this.grow();
  }

  Pulser.prototype.grow = function() {
    var animation;
    animation = this.animate({
      properties: {
        scale: 3,
        opacity: 0
      },
      time: 1.3,
      curve: "cubic-bezier(0, 0, .4, 1)"
    });
    return animation.on(Events.AnimationEnd, (function(_this) {
      return function() {
        _this.scale = 1;
        _this.opacity = 1;
        return Utils.delay(.5, _this.grow);
      };
    })(this));
  };

  return Pulser;

})(Layer);
// Generated by CoffeeScript 1.7.1
var Bubble, Expander, container, contractAll, contractButton, expandAll, expandButton, expanders, gridSpacer, gridX, gridY, i, j, objectCenter, sortButton, sortByID, sortBySize, _i, _j,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Bubble = (function() {
  function Bubble(parent, objectCenter, size, color, isMain, offset, angle) {
    var bubble;
    this.parent = parent;
    this.objectCenter = objectCenter;
    this.size = size;
    this.color = color;
    this.isMain = isMain != null ? isMain : false;
    this.offset = offset != null ? offset : 100;
    this.angle = angle != null ? angle : null;
    bubble = new Layer({
      superLayer: this.parent,
      height: this.size,
      width: this.size,
      x: objectCenter.x - this.size / 2,
      y: objectCenter.y - this.size / 2,
      borderRadius: this.size / 2,
      backgroundColor: this.color,
      opacity: 0
    });
    bubble.objectCenter = this.objectCenter;
    if (this.isMain) {
      bubble.opacity = 1;
    }
    if (this.isMain) {
      bubble.states.animationOptions = {
        time: 0.2
      };
    } else {
      bubble.states.animationOptions = {
        curve: "spring(300, 10, 0)",
        time: 0.2
      };
    }
    if (this.isMain) {
      bubble.states.add({
        open: {
          opacity: 0.25
        }
      });
    } else {
      bubble.states.add({
        open: {
          x: bubble.objectCenter.x - (this.offset * Math.sin(this.angle)) - this.size / 2,
          y: bubble.objectCenter.y - (this.offset * Math.cos(this.angle)) - this.size / 2,
          opacity: 1
        }
      });
    }
    bubble.recenter = (function(_this) {
      return function(objectCenter) {
        bubble.objectCenter = objectCenter;
        if (_this.isMain) {
          bubble.states._states["default"] = {
            x: bubble.objectCenter.x - _this.size / 2,
            y: bubble.objectCenter.y - _this.size / 2,
            opacity: 1
          };
          return bubble.states._states.open = {
            x: bubble.objectCenter.x - _this.size / 2,
            y: bubble.objectCenter.y - _this.size / 2,
            opacity: 0.25
          };
        } else {
          bubble.states._states["default"] = {
            x: bubble.objectCenter.x - _this.size / 2,
            y: bubble.objectCenter.y - _this.size / 2,
            opacity: 0
          };
          return bubble.states._states.open = {
            x: bubble.objectCenter.x - (_this.offset * Math.sin(_this.angle)) - _this.size / 2,
            y: bubble.objectCenter.y - (_this.offset * Math.cos(_this.angle)) - _this.size / 2,
            opacity: 1
          };
        }
      };
    })(this);
    return bubble;
  }

  return Bubble;

})();

Expander = (function() {
  function Expander(parent, objectCenter, size, numSubBubbles) {
    var i, that, _i, _ref;
    this.parent = parent;
    this.objectCenter = objectCenter;
    this.size = size;
    this.numSubBubbles = numSubBubbles;
    this.recenter = __bind(this.recenter, this);
    this.contract = __bind(this.contract, this);
    this.expand = __bind(this.expand, this);
    this.mainBubble = new Bubble(this.parent, this.objectCenter, this.size, "#00ccff", true);
    this.mainBubble.id = this.id;
    this.angleIncrement = 2 * Math.PI / this.numSubBubbles;
    this.subBubbles = [];
    for (i = _i = 0, _ref = this.numSubBubbles; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      this.subBubbles.push(new Bubble(this.parent, this.objectCenter, Math.random() * this.size / 2 + this.size / 5, "#ff9933", false, this.size, this.angleIncrement * i));
    }
    this.mainBubble.bringToFront();
    that = this;
    this.mainBubble.on(Events.Click, function() {
      var subBubble, _j, _len, _ref1, _results;
      that.mainBubble.states.next();
      _ref1 = that.subBubbles;
      _results = [];
      for (_j = 0, _len = _ref1.length; _j < _len; _j++) {
        subBubble = _ref1[_j];
        _results.push(subBubble.states.next());
      }
      return _results;
    });
  }

  Expander.prototype.expand = function() {
    var bubble, _i, _len, _ref, _results;
    this.mainBubble.states["switch"]('open');
    _ref = this.subBubbles;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      bubble = _ref[_i];
      _results.push(bubble.states["switch"]('open'));
    }
    return _results;
  };

  Expander.prototype.contract = function() {
    var bubble, _i, _len, _ref, _results;
    this.mainBubble.states["switch"]('default');
    _ref = this.subBubbles;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      bubble = _ref[_i];
      _results.push(bubble.states["switch"]('default'));
    }
    return _results;
  };

  Expander.prototype.recenter = function(objectCenter) {
    var subBubble, _i, _len, _ref, _results;
    this.mainBubble.recenter(objectCenter);
    this.mainBubble.states["switch"](this.mainBubble.states.current);
    _ref = this.subBubbles;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      subBubble = _ref[_i];
      subBubble.states.animationOptions = {
        curve: "linear",
        time: 0.2
      };
      subBubble.recenter(objectCenter);
      subBubble.states["switch"](subBubble.states.current);
      _results.push(subBubble.states.animationOptions = {
        curve: "spring(300, 10, 0)",
        time: 0.2
      });
    }
    return _results;
  };

  return Expander;

})();

container = new Layer({
  height: Screen.height,
  width: Screen.width,
  backgroundColor: 'rgba(0,0,0,0)'
});

container.scroll = true;

objectCenter = {
  x: Screen.width / 2,
  y: Screen.height / 2
};

gridX = 2;

gridY = 20;

gridSpacer = 200;

expanders = [];

for (i = _i = 0; 0 <= gridX ? _i <= gridX : _i >= gridX; i = 0 <= gridX ? ++_i : --_i) {
  for (j = _j = 0; 0 <= gridY ? _j <= gridY : _j >= gridY; j = 0 <= gridY ? ++_j : --_j) {
    objectCenter = {
      x: Screen.width / 2 - gridSpacer + gridSpacer * i,
      y: Screen.height / 2 - gridSpacer + gridSpacer * j
    };
    expanders.push(new Expander(container, objectCenter, Math.random() * 50 + 20, Math.round(Math.random() * 8) + 2));
  }
}

expandAll = function() {
  var expander, _k, _len, _results;
  _results = [];
  for (_k = 0, _len = expanders.length; _k < _len; _k++) {
    expander = expanders[_k];
    _results.push(expander.expand());
  }
  return _results;
};

contractAll = function() {
  var expander, _k, _len, _results;
  _results = [];
  for (_k = 0, _len = expanders.length; _k < _len; _k++) {
    expander = expanders[_k];
    _results.push(expander.contract());
  }
  return _results;
};

sortBySize = function() {
  var ind, sortedExpanders, _k, _results;
  sortedExpanders = _.sortBy(expanders, function(e) {
    return e.size;
  }).reverse();
  ind = 0;
  _results = [];
  for (i = _k = 0; 0 <= gridY ? _k <= gridY : _k >= gridY; i = 0 <= gridY ? ++_k : --_k) {
    _results.push((function() {
      var _l, _results1;
      _results1 = [];
      for (j = _l = 0; 0 <= gridX ? _l <= gridX : _l >= gridX; j = 0 <= gridX ? ++_l : --_l) {
        objectCenter = {
          y: Screen.height / 2 - gridSpacer + gridSpacer * i,
          x: Screen.width / 2 - gridSpacer + gridSpacer * j
        };
        sortedExpanders[ind].recenter(objectCenter);
        _results1.push(ind += 1);
      }
      return _results1;
    })());
  }
  return _results;
};

sortByID = function() {
  var ind, sortedExpanders, _k, _results;
  sortedExpanders = _.sortBy(expanders, function(e) {
    return e.mainBubble._id;
  }).reverse();
  ind = 0;
  _results = [];
  for (i = _k = 0; 0 <= gridY ? _k <= gridY : _k >= gridY; i = 0 <= gridY ? ++_k : --_k) {
    _results.push((function() {
      var _l, _results1;
      _results1 = [];
      for (j = _l = 0; 0 <= gridX ? _l <= gridX : _l >= gridX; j = 0 <= gridX ? ++_l : --_l) {
        objectCenter = {
          y: Screen.height / 2 - gridSpacer + gridSpacer * i,
          x: Screen.width / 2 - gridSpacer + gridSpacer * j
        };
        sortedExpanders[ind].recenter(objectCenter);
        _results1.push(ind += 1);
      }
      return _results1;
    })());
  }
  return _results;
};

expandButton = new Layer({
  height: 40,
  width: 100,
  x: Screen.width / 2 + 150,
  y: 50,
  borderRadius: 20,
  backgroundColor: '#999999'
});

Utils.labelLayer(expandButton, 'Expand All');

expandButton.on(Events.Click, function() {
  return expandAll();
});

sortButton = new Layer({
  height: 40,
  width: 100,
  x: Screen.width / 2 - 50,
  y: 50,
  borderRadius: 20,
  backgroundColor: '#999999'
});

sortButton.state = 'id';

Utils.labelLayer(sortButton, 'Sort');

sortButton.on(Events.Click, function() {
  if (sortButton.state === 'id') {
    sortButton.state = 'size';
    return sortBySize();
  } else {
    sortButton.state = 'id';
    return sortByID();
  }
});

contractButton = new Layer({
  height: 40,
  width: 100,
  x: Screen.width / 2 - 250,
  y: 50,
  borderRadius: 20,
  backgroundColor: '#999999'
});

Utils.labelLayer(contractButton, 'contract All');

contractButton.on(Events.Click, function() {
  return contractAll();
});
